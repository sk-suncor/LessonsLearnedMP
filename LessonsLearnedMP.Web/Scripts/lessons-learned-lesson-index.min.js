$(function(){$("select:not(.nostyle)").livequery(function(){$("#LessonList_length select").selectmenu()});$("#LongFormViewContent:not(.no-resize)").livequery(function(){$(this).resizable({minHeight:200,handles:"s",alsoResize:"#LongFormView",resize:function(e,f){$("#LongFormView").css("max-height",f.size.height)},stop:function(e,f){$.ajax({url:siteRoot+"Shared/SetLongFormViewHeight/",type:"POST",dataType:"json",data:{height:f.size.height}})}})});$("#LessonGrid .dataTables_scrollBody").livequery(function(){$(this).resizable({minHeight:50,handles:"s",stop:function(e,f){$.ajax({url:siteRoot+"Shared/SetLessonListHeight/",type:"POST",dataType:"json",data:{height:f.size.height}})}})});$(".row-combo-button, .row-menu-button, .ui-menu-item").livequery(function(){$(this).hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})});$(".row-menu-button").livequery(function(){$(this).click(function(){var f=this;var e=$(this).parent().parent().find(".ui-menu").show().position({my:"left top",at:"left bottom",of:f});$(document).one("click",function(){e.hide()});return false})});$("#LessonList_length").change(function(){alert("Handler for .change() called.")});$("#LessonList_length").live("change",function(){$.ajax({url:siteRoot+"Shared/SetSearchListPageSize/",type:"POST",dataType:"json",data:{size:$("option:selected",this).val()}})});var a=[{sName:"Enabled",sWidth:"0px",bVisible:false},{sName:"Selected",sWidth:"30px",bSearchable:false,bSortable:false,sClass:"center first",fnRender:function(e){return"<div class='checkbox-field'><input class='lesson-checkbox' type='checkbox' /></div>"}},{sName:"Id",sWidth:"75px",bSearchable:false,bSortable:true,fnRender:function(e){var f=e.aData[e.iDataColumn];f="<div class='id-field'><a href='"+siteRoot+"Lesson/"+(e.aData[10]==1?"Submit":"Edit")+"/"+f+"'>"+f+"</a></div>";return f}},{sName:"Status",sWidth:"100px",bSearchable:false,bSortable:true,fnRender:function(e){return"<div class='status-field'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"Title",bSearchable:false,bSortable:true,fnRender:function(e){return"<div class='title-field'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"Discipline",sWidth:"100px",bSearchable:false,bSortable:true,fnRender:function(e){return"<div class='discipline-field'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"SubmitDate",sWidth:"70px",bSearchable:false,bSortable:true,fnRender:function(e){return"<div class='session-field'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"Contact",sWidth:"140px",bSearchable:false,bSortable:true,fnRender:function(e){return"<div class='contact-field'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"Actions",sClass:"last",sWidth:"100px",bSearchable:false,bSortable:false,fnRender:function(e){return"<div class='actions-field'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"LessonId",sWidth:"0px",bVisible:false},{sName:"StatusId",sWidth:"0px",bVisible:false}];var b="";var c="";var d=$("#LessonList").dataTable({aLengthMenu:[[10,25,50,100],[10,25,50,100]],bJQueryUI:true,sPaginationType:"full_numbers",bProcessing:true,bServerSide:true,bFilter:true,bSortMulti:false,bLengthChange:true,bStateSave:false,bAutoWidth:false,iDisplayLength:pageSize,sScrollY:lessonListHeight,sDom:'<"H"lir<"#LessonHelp">>t<"F"<"#BulkActions">p>;',sAjaxSource:siteRoot+"Lesson/GetLessonList",aoColumns:a,bDeferRender:true,iDeferLoading:0,fnServerData:function(g,e,f){$.ajax({dataType:"json",type:"POST",url:g,data:e,success:function(h){c=h.gridMessage;f(h)}})},fnRowCallback:function(g,e,f){if(e[0]=="False"){$(g).addClass("deleted")}$(g).attr("data-enabled",e[0]);$(g).attr("data-lessonId",e[9]);$("td:eq(2)",g).addClass("status-"+e[10]);if(typeof selectedLessonId!=="undefined"&&selectedLessonId==e[9]){$(g).addClass("editing-row")}return g},fnInfoCallback:function(i,g,e,f,h,j){return c+", "+j},fnDrawCallback:function(e){InitializeSelectAllCheckbox("select-all","lesson-checkbox");$("#LessonHelp").html('<span class="web-sprite sprite-help-browser float-right helptip" data-helpTopic="1" style="margin-right: 5px"></span>');$(".deferred").show()},fnServerParams:function(e){e.push({name:"SearchModelJson",value:searchModelString});e.push({name:"NavigationPage",value:navigationPage})},});if(d.length){d.fnSort([[2,"desc"]])}$("#BulkActions .lesson-action").live("click",function(){$(".row-menu-button").parent().parent().find(".ui-menu").hide();var h=$(this).attr("data-saveAction");if(h==saveActionNone){return}var f=$(".lesson-checkbox:checked");var i=[];if(f.length>0){f.each(function(){i.push(parseInt($(this).closest("tr").attr("data-lessonId")))})}if(h==saveActionAdminToBPO||h==saveActionBPOToBPO){$("#BulkActionTransferBpoDisciplineId option").remove();$("#BulkActionTransferBpoDisciplineId option").clone().appendTo("#BulkLesson_TransferBpoDisciplineId");var g=$("#SectionTransferToBPOBulk").html();$("#SectionTransferToBPOBulk").html("");$(g).dialog({modal:true,width:600,title:"Transfer Selected to BPO",draggable:false,resizable:false,buttons:{"Transfer Selected":function(){var k=true;if(!$("#BulkLesson_TransferBpoComment",this).val()){k=false;$("#BulkLesson_TransferBpoComment_validationMessage").addClass("field-validation-error").removeClass("field-validation-valid").addClass("field-validation-error")}if(!$("#BulkLesson_TransferBpoDisciplineId",this).val()){k=false;$("#BulkLesson_TransferBpoDisciplineId_validationMessage").addClass("field-validation-error").removeClass("field-validation-valid").addClass("field-validation-error")}if(k){$("#BulkLessonForm").append($("#SectionTransferToBPOWrapperBulk").html());$("#BulkLessonForm").append('<input type="hidden" id="BulkSelectedLessons" name="BulkSelectedLessons" value="'+i.join(",")+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_SaveAction" name="BulkLesson.SaveAction" value="'+h+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_ReturnToAction" name="BulkLesson.ReturnToAction" value="'+pageAction+'" />');$("#BulkLessonForm").submit()}},Cancel:function(){$(this).dialog("close")}},beforeClose:function(){$("#SectionTransferToBPOBulk").html(g)},open:function(){setTimeout(function(){$("#BulkLesson_TransferBpoComment").focus()},200)}}).dialog("open").find("textarea").addClass("ui-widget ui-state-default ui-corner-all").end().find("#SectionTransferToBPOWrapperBulk").show()}else{if(h==saveActionAdminToClarification||h==saveActionBPOToClarification||h==saveActionClarificationToBPO||h==saveActionClarificationToAdmin){var g=$("#SectionRequiresClarificationBulk").html();$("#SectionRequiresClarificationBulk").html("");var j="Request Clarification For Selected Lessons";var e="Request Clarification";if(h==saveActionClarificationToBPO){j="Clarify and Transfer Selected Lessons To BPO";e="Transfer Back to BPO"}if(h==saveActionClarificationToAdmin){j="Clarify and Transfer Selected Lessons To Administrator";e="Transfer Back to Administrator"}$(g).dialog({modal:true,width:600,title:j,draggable:false,resizable:false,buttons:[{text:e,click:function(){var k=true;if(!$("#BulkLesson_ClarificationComment",this).val()){k=false}toggleValidation($("#BulkLesson_ClarificationComment_validationMessage"),k);if(k){$("#BulkLessonForm").append($("#SectionRequiresClarificationWrapperBulk").html());$("#BulkLessonForm").append('<input type="hidden" id="BulkSelectedLessons" name="BulkSelectedLessons" value="'+i.join(",")+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_SaveAction" name="BulkLesson.SaveAction" value="'+h+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_ReturnToAction" name="BulkLesson.ReturnToAction" value="'+pageAction+'" />');$("#BulkLessonForm").submit()}}},{text:"Cancel",click:function(){$(this).dialog("close")}}],beforeClose:function(){$("#SectionRequiresClarificationBulk").html(g)},open:function(){setTimeout(function(){$("#BulkLesson_ClarificationComment").focus()},200)}}).dialog("open").find("textarea").addClass("ui-widget ui-state-default ui-corner-all").end().find("#SectionRequiresClarificationWrapperBulk").show()}else{if(h==saveActionBPOToClose){var g=$("#SectionClosedPopupBulk").html();$("#SectionClosedPopupBulk").html("");$(g).dialog({modal:true,width:600,title:"Validate and Close",draggable:false,resizable:false,buttons:{"Process Selected":function(){var k=this;var l=true;toggleValidation($("#BulkLesson_LessonTypeId_validationMessage"),true);toggleValidation($("#BulkLesson_Resolution_validationMessage"),true);if(!$("#BulkLesson_LessonTypeValidId",this).val()&&!$("#BulkLesson_LessonTypeInvalidId",this).val()){l=false;toggleValidation($("#BulkLesson_LessonTypeId_validationMessage"),false)}if($.trim($("#BulkLesson_Resolution",k).val())==""){l=false;toggleValidation($("#BulkLesson_Resolution_validationMessage"),false)}if(l){$("#BulkLessonForm").append($("#SectionClosedPopupWrapperBulk").html());$("#BulkLessonForm").append('<input type="hidden" id="BulkSelectedLessons" name="BulkSelectedLessons" value="'+i.join(",")+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_SaveAction" name="BulkLesson.SaveAction" value="'+h+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_ReturnToAction" name="BulkLesson.ReturnToAction" value="'+pageAction+'" />');$("#BulkLessonForm").submit()}},Cancel:function(){$(this).dialog("close")}},beforeClose:function(){$("#SectionClosedPopupBulk").html(g)},open:function(){$("#BulkLesson_LessonTypeInvalidId-button").hide();setTimeout(function(){$("#BulkLesson_CloseComment").focus()},200)}}).dialog("open").find("textarea").addClass("ui-widget ui-state-default ui-corner-all").end().find("#CloseSectionClosedPopupWrapperBulk").show()}else{if(h==saveActionDelete){$("<div>Are you sure you wish to delete all of the selected lessons?</div>").dialog({modal:true,width:300,title:"Delete all selected Lessons?",draggable:false,resizable:false,buttons:{"Delete Selected":function(){$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_SaveAction" name="BulkLesson.SaveAction" value="'+h+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkSelectedLessons" name="BulkSelectedLessons" value="'+i.join(",")+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_ReturnToAction" name="BulkLesson.ReturnToAction" value="'+pageAction+'" />');$("#BulkLessonForm").submit()},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}else{if(h==saveActionAssignToUser){var g=$("#SectionAssignToUserBulk").html();$("#SectionAssignToUserBulk").html("");$("#SectionAssignToUserBulk option").clone().appendTo("#BulkLesson_TransferBpoDisciplineId");var j="Assign selected to user";var e="Assign";$(g).dialog({modal:true,width:600,title:j,draggable:false,resizable:false,buttons:[{text:e,click:function(){var k=true;if(!$("#BulkLesson_AssignToUserId",this).val()){k=false;$("#BulkLesson_AssignToUserId_validationMessage").addClass("field-validation-error").removeClass("field-validation-valid").addClass("field-validation-error")}if(k){$("#BulkLessonForm").append($("#SectionAssignToUserWrapperBulk").html());$("#BulkLessonForm").append('<input type="hidden" id="BulkSelectedLessons" name="BulkSelectedLessons" value="'+i.join(",")+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_SaveAction" name="BulkLesson.SaveAction" value="'+h+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_ReturnToAction" name="BulkLesson.ReturnToAction" value="'+pageAction+'" />');$("#BulkLessonForm").submit()}}},{text:"Cancel",click:function(){$(this).dialog("close")}}],beforeClose:function(){$("#SectionAssignToUserBulk").html(g)},open:function(){setTimeout(function(){$("#BulkLesson_AssignUserId").focus()},200)}}).dialog("open").find("textarea").addClass("ui-widget ui-state-default ui-corner-all").end().find("#SectionAssignToUserWrapperBulk").show()}else{$("#BulkLessonForm").append('<input type="hidden" id="BulkSelectedLessons" name="BulkSelectedLessons" value="'+i.join(",")+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_SaveAction" name="BulkLesson.SaveAction" value="'+h+'" />');$("#BulkLessonForm").append('<input type="hidden" id="BulkLesson_ReturnToAction" name="BulkLesson.ReturnToAction" value="'+pageAction+'" />');$("#BulkLessonForm").submit()}}}}}return false});toggleBulkLessonType();$("input[name='BulkLesson.IsLessonTypeValidSelected']").livequery(function(){$(this).change(function(){toggleBulkLessonType()})})});var calcDataTableHeight=function(){return Math.round($("#LessonGridResize").height())};function toggleBulkLessonType(){if($("input[name='BulkLesson.IsLessonTypeValidSelected']:checked").val()=="True"){$("#BulkLesson_LessonTypeInvalidId").hide();$("#BulkLesson_LessonTypeValidId").show()}else{$("#BulkLesson_LessonTypeValidId").hide();$("#BulkLesson_LessonTypeInvalidId").show()}}function UpdateSelectAllCheckbox(e,c){var d=$("."+e);var b=$("."+c).not(".not-linked");var f=b.length;var a=b.filter(":checked").length;if(f==a){d.removeClass("state-unchecked state-intermediate").addClass("state-checked")}else{if(a>0){d.removeClass("state-checked state-unchecked").addClass("state-intermediate")}else{d.removeClass("state-checked state-intermediate").addClass("state-unchecked")}}UpdateBulkActionButton()}function UpdateBulkActionButton(){$("#BulkActions").html("");var a=$(".lesson-checkbox:checked");var b=[];if(a.length>0){a.each(function(){b.push(parseInt($(this).closest("tr").attr("data-lessonId")))})}$.ajax({url:siteRoot+"Shared/ActionButtonBulk",type:"POST",dataType:"html",contentType:"application/json",data:JSON.stringify({selectedLessonIds:b}),success:function(c){$("#BulkActions").html(c)}})}$.extend({distinct:function(a){var b=[];$.each(a,function(c,d){if($.inArray(d,b)==-1){b.push(d)}});return b}});function InitializeSelectAllCheckbox(d,b){var c=$("."+d);var a=$("."+b).not(".not-linked");c.unbind("click");c.click(function(){if($(this).hasClass("state-checked")){a.attr("checked",false).change()}else{a.attr("checked",true).change()}UpdateSelectAllCheckbox(d,b)});a.unbind("click");a.click(function(){UpdateSelectAllCheckbox(d,b)});c.unbind("hover");c.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});UpdateSelectAllCheckbox(d,b)};