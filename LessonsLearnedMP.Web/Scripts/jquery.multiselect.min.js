(function(a,c){var b=0;a.widget("ech.multiselect",{options:{header:true,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:"",hide:"",autoOpen:false,multiple:true,position:{}},_create:function(){var g=this.element.hide(),l=this.options;this.speed=a.fx.speeds._default;this._isOpen=false;var j=this.element.hasClass("input-validation-error");var d=(this.button=a('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all "+(j?"input-validation-error":"")).addClass(l.classes).attr({title:g.attr("title"),"aria-haspopup":true,tabIndex:g.attr("tabIndex")}).insertAfter(g),e=(this.buttonlabel=a("<span />")).html(l.noneSelectedText).appendTo(d),k=(this.menu=a("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(l.classes).appendTo(document.body),h=(this.header=a("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(k),i=(this.headerLinkContainer=a("<ul />")).addClass("ui-helper-reset").html(function(){if(l.header===true){return'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+l.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+l.uncheckAllText+"</span></a></li>"}else{if(typeof l.header==="string"){return"<li>"+l.header+"</li>"}else{return""}}}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(h),f=(this.checkboxContainer=a("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(k);this._bindEvents();this.refresh(true);if(!l.multiple){k.addClass("ui-multiselect-single")}},_init:function(){if(this.options.header===false){this.header.hide()}if(!this.options.multiple){this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide()}if(this.options.autoOpen){this.open()}if(this.element.is(":disabled")){this.disable()}},refresh:function(h){var e=this.element,j=this.options,i=this.menu,d=this.checkboxContainer,k=[],f=[],g=e.attr("id")||b++;e.find("option").each(function(n){var l=a(this),t=this.parentNode,u=this.innerHTML,m=this.title,v=this.value,o=this.id||"ui-multiselect-"+g+"-option-"+n,p=this.disabled,q=this.selected,r=["ui-corner-all"],s;if(t.tagName.toLowerCase()==="optgroup"){s=t.getAttribute("label");if(a.inArray(s,k)===-1){f.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+s+"</a></li>");k.push(s)}}if(p){r.push("multi-select-disabled")}if(q&&!j.multiple){r.push("ui-state-active")}f.push('<li class="'+(p?"ui-multiselect-disabled":"")+'">');f.push('<label for="'+o+'" title="'+m+'" class="'+r.join(" ")+'">');f.push('<input id="'+o+'" name="multiselect_'+g+'" type="'+(j.multiple?"checkbox":"radio")+'" value="'+v+'" title="'+u+'"');if(q){f.push(' checked="checked"');f.push(' aria-selected="true"')}if(p){f.push(' disabled="disabled"');f.push(' aria-disabled="true"')}f.push(" /><span>"+u+"</span></label></li>")});d.html(f.join(""));this.labels=i.find("label");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();if(!h){this._trigger("refresh")}},update:function(){var g=this.options,e=this.labels.find("input"),d=e.filter("[checked]"),f=d.length,h;if(f===0){h=g.noneSelectedText}else{if(a.isFunction(g.selectedText)){h=g.selectedText.call(this,f,e.length,d.get())}else{if(/\d/.test(g.selectedList)&&g.selectedList>0&&f<=g.selectedList){h=d.map(function(){return a(this).next().text()}).get().join(", ")}else{h=g.selectedText.replace("#",f).replace("#",e.length)}}}this.buttonlabel.html(h);return h},_bindEvents:function(){var f=this,d=this.button;function e(){f[f._isOpen?"close":"open"]();return false}d.find("span").bind("click.multiselect",e);d.bind({click:e,keypress:function(g){switch(g.which){case 27:case 38:case 37:f.close();break;case 39:case 40:f.open();break}},mouseenter:function(){if(!d.hasClass("multi-select-disabled")){a(this).addClass("ui-state-hover")}},mouseleave:function(){a(this).removeClass("ui-state-hover")},focus:function(){if(!d.hasClass("multi-select-disabled")){a(this).addClass("ui-state-focus")}},blur:function(){a(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(g){if(a(this).hasClass("ui-multiselect-close")){f.close()}else{f[a(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]()}g.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(i){i.preventDefault();var h=a(this),g=h.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),k=g.get(),j=h.parent().text();if(f._trigger("beforeoptgrouptoggle",i,{inputs:k,label:j})===false){return}f._toggleChecked(g.filter("[checked]").length!==g.length,g);f._trigger("optgrouptoggle",i,{inputs:k,label:j,checked:k[0].checked})}).delegate("label","mouseenter.multiselect",function(){if(!a(this).hasClass("multi-select-disabled")){f.labels.removeClass("ui-state-hover");a(this).addClass("ui-state-hover").find("input").focus()}}).delegate("label","keydown.multiselect",function(g){g.preventDefault();switch(g.which){case 9:case 27:f.close();break;case 38:case 40:case 37:case 39:f._traverse(g.which,this);break;case 13:a(this).find("input")[0].click();break}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(i){var g=a(this),k=this.value,h=this.checked,j=f.element.find("option");if(this.disabled||f._trigger("click",i,{value:k,text:this.title,checked:h})===false){i.preventDefault();return}g.focus();g.attr("aria-selected",h);j.each(function(){if(this.value===k){this.selected=h}else{if(!f.options.multiple){this.selected=false}}});if(!f.options.multiple){f.labels.removeClass("ui-state-active");g.closest("label").toggleClass("ui-state-active",h);f.close()}f.element.trigger("change");setTimeout(a.proxy(f.update,f),10)});a(document).bind("mousedown.multiselect",function(g){if(f._isOpen&&!a.contains(f.menu[0],g.target)&&!a.contains(f.button[0],g.target)&&g.target!==f.button[0]){f.close()}});a(this.element[0].form).bind("reset.multiselect",function(){setTimeout(a.proxy(f.refresh,f),10)})},_setButtonWidth:function(){var e=this.element.outerWidth(),d=this.options;if(/\d/.test(d.minWidth)&&e<d.minWidth){e=d.minWidth}this.button.width(e)},_setMenuWidth:function(){var d=this.menu,e=this.button.outerWidth()-parseInt(d.css("padding-left"),10)-parseInt(d.css("padding-right"),10)-parseInt(d.css("border-right-width"),10)-parseInt(d.css("border-left-width"),10);d.width(e||this.button.outerWidth())},_traverse:function(i,h){var f=a(h),g=i===38||i===37,e=f.parent()[g?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[g?"last":"first"]();if(!e.length){var d=this.menu.find("ul").last();this.menu.find("label")[g?"last":"first"]().trigger("mouseover");d.scrollTop(g?d.height():0)}else{e.find("label").trigger("mouseover")}},_toggleState:function(e,d){return function(){if(!this.disabled){this[e]=d}if(d){this.setAttribute("aria-selected",true)}else{this.removeAttribute("aria-selected")}}},_toggleChecked:function(e,f){var d=(f&&f.length)?f:this.labels.find("input"),g=this;d.each(this._toggleState("checked",e));d.eq(0).focus();this.update();var h=d.map(function(){return this.value}).get();this.element.find("option").each(function(){if(!this.disabled&&a.inArray(this.value,h)>-1){g._toggleState("selected",e).call(this)}});if(d.length){this.element.trigger("change")}},_toggleDisabled:function(d){this.button.attr({disabled:d,"aria-disabled":d})[d?"addClass":"removeClass"]("multi-select-disabled");this.menu.find("input").attr({disabled:d,"aria-disabled":d}).parent()[d?"addClass":"removeClass"]("multi-select-disabled");this.element.attr({disabled:d,"aria-disabled":d})},open:function(g){var l=this,f=this.button,i=this.menu,m=this.speed,j=this.options;if(this._trigger("beforeopen")===false||f.hasClass("multi-select-disabled")||this._isOpen){return}var d=i.find("ul").last(),h=j.show,k=f.offset();if(a.isArray(j.show)){h=j.show[0];m=j.show[1]||l.speed}d.scrollTop(0).height(j.height);if(a.ui.position&&!a.isEmptyObject(j.position)){j.position.of=j.position.of||f;i.show().position(j.position).hide().show(h,m)}else{i.css({top:k.top+f.outerHeight(),left:k.left}).show(h,m)}this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");f.addClass("ui-state-active");this._isOpen=true;this._trigger("open")},close:function(){if(this._trigger("beforeclose")===false){return}var e=this.options,d=e.hide,f=this.speed;if(a.isArray(e.hide)){d=e.hide[0];f=e.hide[1]||this.speed}this.menu.hide(d,f);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=false;this._trigger("close")},enable:function(){this._toggleDisabled(false)},disable:function(){this._toggleDisabled(true)},checkAll:function(d){this._toggleChecked(true);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(false);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter("[checked]")},destroy:function(){a.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},_setOption:function(d,f){var e=this.menu;switch(d){case"header":e.find("div.ui-multiselect-header")[f?"show":"hide"]();break;case"checkAllText":e.find("a.ui-multiselect-all span").eq(-1).text(f);break;case"uncheckAllText":e.find("a.ui-multiselect-none span").eq(-1).text(f);break;case"height":e.find("ul").last().height(parseInt(f,10));break;case"minWidth":this.options[d]=parseInt(f,10);this._setButtonWidth();this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[d]=f;this.update();break;case"classes":e.add(this.button).removeClass(this.options.classes).addClass(f);break}a.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);