$(function(){$("select:not(.nostyle)").livequery(function(){$(this).selectmenu()});if(readOnly){$("#ThemeIds option").each(function(){$(this).attr("disabled","disabled")})}$("#ThemeIds").multiselect({noneSelectedText:readOnly?"None":"Select Theme(s)",classes:"theme"+(readOnly?" ui-state-disabled":""),header:!readOnly});$("#ThemeIds").bind("multiselectcheckall",function(){if(!readOnly){$("#ThemeDescriptionTarget").show();alert("Enter a Theme Description")}});$("#ThemeIds").bind("multiselectuncheckall",function(){if(!readOnly){$("#ThemeDescription").val("");$("#ThemeDescriptionTarget").hide()}});$("#ThemeIds").bind("multiselectclick",function(e,f){if(f.value==themeOtherValue){if(f.checked){$("#ThemeDescriptionTarget").show();alert("Enter a Theme Description")}else{$("#ThemeDescription").val("");$("#ThemeDescriptionTarget").hide()}}});$(".ui-multiselect.theme").tooltip({bodyHandler:function(){var e=$.map($("#ThemeIds").multiselect("getChecked"),function(h){return h.title});var g=[];$.each(e,function(h,j){g.push("<li>"+j+"</li>")});var f=$("<ul></ul>").append(g.join(""));return $(f).html()}});$("#RiskRankingId").selectmenu({format:function(e){return'<span class="ui-widget ui-corner-all risk-ranking-'+e+'">&nbsp;&nbsp;'+e+"</span>"}});$(".section-item input:text, .section-item input:password, .section-item textarea").livequery(function(){$(this).hover(function(){$(this).addClass("ui-state-active")},function(){$(this).removeClass("ui-state-active")})});$(".section-item input:text, .section-item input:password, .section-item textarea").livequery(function(){$(this).focusin(function(){$(this).addClass("ui-state-focus")})});$(".section-item input:text, .section-item input:password, .section-item textarea").livequery(function(){$(this).focusout(function(){$(this).removeClass("ui-state-focus")})});$(".datepicker").livequery(function(){$(this).datepicker({showAnim:"slideDown",dateFormat:"yy-mm-dd",minDate:-365,beforeShow:function(){$("#ui-datepicker-div").wrap("<div class='inverse-theme' />")}})});$("#HeaderContent .lesson-action").click(function(){var j=$(this).attr("data-saveAction");if(j==saveActionAdminToBPO||j==saveActionBPOToBPO){var h=$("#SectionTransferToBPO").html();$("#SectionTransferToBPO").html("");$(h).dialog({modal:true,width:600,title:"Transfer to BPO",draggable:false,resizable:false,buttons:{"Transfer to BPO":function(){var m=true;if(!$("#TransferBpoComment",this).val()){m=false;$("#TransferBpoComment_validationMessage").addClass("field-validation-error").removeClass("field-validation-valid").addClass("field-validation-error")}if(!$("#TransferBpoDisciplineId",this).val()){m=false;$("#TransferBpoDisciplineId_validationMessage").addClass("field-validation-error").removeClass("field-validation-valid").addClass("field-validation-error")}if(m){$("#LessonForm").append($("#SectionTransferToBPOWrapper").html());$("#LessonForm").append('<input type="hidden" id="SaveAction" name="SaveAction" value="'+j+'" />');$("#LessonForm").submit()}},Cancel:function(){$(this).dialog("close")}},beforeClose:function(){$("#SectionTransferToBPO").html(h)},open:function(){setTimeout(function(){$("#TransferBpoComment").focus()},200)}}).dialog("open").find("select").selectmenu().end().find("textarea").addClass("ui-widget ui-state-default ui-corner-all").end().find("#SectionTransferToBPOWrapper").show()}else{if(j==saveActionAdminToClarification||j==saveActionBPOToClarification||j==saveActionClarificationToBPO||j==saveActionClarificationToAdmin){var h=$("#SectionRequiresClarification").html();$("#SectionRequiresClarification").html("");var l="Request Clarification";var g="Request Clarification";if(j==saveActionClarificationToBPO){l="Clarify and Transfer To BPO";g="Transfer Back to BPO"}if(j==saveActionClarificationToAdmin){l="Clarify and Transfer To Administrator";g="Transfer Back to Administrator"}$(h).dialog({modal:true,width:600,title:l,draggable:false,resizable:false,buttons:[{text:g,click:function(){var m=true;if(!$("#ClarificationComment",this).val()){m=false;$("#ClarificationComment_validationMessage").addClass("field-validation-error").removeClass("field-validation-valid").addClass("field-validation-error")}if(m){$("#LessonForm").append($("#SectionRequiresClarificationWrapper").html());$("#LessonForm").append('<input type="hidden" id="SaveAction" name="SaveAction" value="'+j+'" />');$("#LessonForm").submit()}}},{text:"Cancel",click:function(){$(this).dialog("close")}}],beforeClose:function(){$("#SectionRequiresClarification").html(h)},open:function(){setTimeout(function(){$("#ClarificationComment").focus()},200)}}).dialog("open").find("select").selectmenu().end().find("textarea").addClass("ui-widget ui-state-default ui-corner-all").end().find("#SectionRequiresClarificationWrapper").show()}else{if(j==saveActionBPOToClose){$("#CloseResolution").val($("#Resolution").val());var e=$("input:radio[name=CloseIsLessonTypeValidSelected]");var f=$("input:radio[name=IsLessonTypeValidSelected]");var i="CloseLessonTypeInvalidId-button";var k="CloseLessonTypeValidId-button";if(f.filter("[value=True]").attr("checked")){e.filter("[value=True]").attr("checked",true)}else{e.filter("[value=True]").removeAttr("checked")}if(f.filter("[value=False]").attr("checked")){e.filter("[value=False]").attr("checked",true);i="CloseLessonTypeValidId-button";k="CloseLessonTypeInvalidId-button"}else{e.filter("[value=False]").removeAttr("checked")}$("#CloseLessonTypeValidId").val($("#LessonTypeValidId").val());$("#CloseLessonTypeInvalidId").val($("#LessonTypeInvalidId").val());var h=$("#SectionClosedPopup").html();$("#SectionClosedPopup").html("");$(h).dialog({modal:true,width:600,title:"Validate and Close",draggable:false,resizable:false,buttons:{Close:function(){var m=this;var n=true;toggleValidation($("#CloseLessonTypeId_validationMessage"),true);toggleValidation($("#CloseResolution_validationMessage"),true);if(!$("#CloseLessonTypeValidId",this).val()&&!$("#CloseLessonTypeInvalidId",this).val()){n=false;toggleValidation($("#CloseLessonTypeId_validationMessage"),false)}if($.trim($("#CloseResolution",m).val())==""){n=false;toggleValidation($("#CloseResolution_validationMessage"),false)}if(n){$("#LessonForm").append($("#SectionClosedPopupWrapper").html());$("#LessonForm").append('<input type="hidden" id="SaveAction" name="SaveAction" value="'+j+'" />');$("#LessonTypeValidId").val($("#CloseLessonTypeValidId").val());$("#LessonTypeInvalidId").val($("#CloseLessonTypeInvalidId").val());$("#Resolution").val($("#CloseResolution").val());$("#LessonForm").submit()}},Cancel:function(){$(this).dialog("close")}},beforeClose:function(){$("#SectionClosedPopup").html(h)},open:function(){$("#CloseLessonTypeInvalidId-button").hide();setTimeout(function(){$("#CloseComment").focus()},200)}}).dialog("open").find("select").selectmenu().end().find("textarea").addClass("ui-widget ui-state-default ui-corner-all").end().find("#"+i).hide().end().find("#"+k).show().end().find("#SectionClosedPopupWrapper").show()}else{if(j==saveActionDelete){$('<div>Are you sure you wish to delete the Lesson "'+$("#Title").val()+'"?</div>').dialog({modal:true,width:300,title:"Delete the Lesson?",draggable:false,resizable:false,buttons:{Delete:function(){$("#LessonForm").append('<input type="hidden" id="SaveAction" name="SaveAction" value="'+j+'" />');$("#LessonForm").submit()},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}else{if(j==saveActionAssignToUser){var h=$("#SectionAssignToUser").html();$("#SectionAssignToUser").html("");var l="Assign to user";var g="Assign";$(h).dialog({modal:true,width:600,title:l,draggable:false,resizable:false,buttons:[{text:g,click:function(){var m=true;if(!$("#AssignToUserId",this).val()){m=false;$("#AssignToUserId_validationMessage").addClass("field-validation-error").removeClass("field-validation-valid").addClass("field-validation-error")}if(m){$("#LessonForm").append($("#SectionAssignToUserWrapper").html());$("#LessonForm").append('<input type="hidden" id="SaveAction" name="SaveAction" value="'+j+'" />');$("#LessonForm").submit()}}},{text:"Cancel",click:function(){$(this).dialog("close")}}],beforeClose:function(){$("#SectionAssignToUser").html(h)},open:function(){setTimeout(function(){$("#AssignUserId").focus()},200)}}).dialog("open").find("textarea").addClass("ui-widget ui-state-default ui-corner-all").end().find("#SectionAssignToUserWrapper").show()}else{$("#LessonForm").append('<input type="hidden" id="SaveAction" name="SaveAction" value="'+j+'" />');$("#LessonForm").submit()}}}}}return false});var a=[{sName:"Enabled",bVisible:false},{sName:"Id",bVisible:false},{sName:"Date",sWidth:"130px",bSearchable:false,bSortable:false,fnRender:function(e){return"<div class='dateField'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"User",sWidth:"100px",bSearchable:false,bSortable:false,fnRender:function(e){return"<div class='userField'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"Type",sWidth:"130px",bSearchable:false,bSortable:false,fnRender:function(e){return"<div class='typeField'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"Comment",bSearchable:false,bSortable:false,fnRender:function(e){return"<div class='commentField'>"+e.aData[e.iDataColumn]+"</div>"}},{sName:"Actions",sWidth:"100px",bSearchable:false,bSortable:false}];if(!admin){a.pop();a.push({sName:"Actions",bVisible:false})}var b="";var c="";var d=$("#CommentList").dataTable({aLengthMenu:[[10,25,50,100],[10,25,50,100]],bJQueryUI:true,sPaginationType:"full_numbers",bProcessing:true,bServerSide:true,bFilter:true,bLengthChange:true,bStateSave:false,bAutoWidth:false,iDisplayLength:pageSize,bScrollCollapse:true,sScrollY:150,sDom:'<"H"ir>t<"F">;',sAjaxSource:siteRoot+"Lesson/GetLessonCommentList/"+$("#CommentList").attr("data-lessonId"),aoColumns:a,iDeferLoading:0,fnRowCallback:function(g,e,f){if(e[0]=="False"){$(g).addClass("deleted")}return g},fnInfoCallback:function(i,g,e,f,h,j){return'<span class="comment-header">Comments</span>'+j+" "+c},fnDrawCallback:function(e){InitializeSelectAllCheckbox("select-all","lesson-checkbox")}});if(d.length>0){d.fnDraw()}$("#CommentList tr").livequery(function(){$(this).hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});var f=this;var e="td";if(admin){e="td:not(:last-child)"}$(e,this).click(function(i){var g=$(f).find(".commentField").html();var h=$(f).find(".dateField").html();var l=$(f).find(".userField").html();var k=$(f).find(".typeField").html();var j=$("<div></div>");j.html(g).dialog({modal:true,width:500,title:k+" - "+l+" ("+h+")"}).dialog("open")})});$(".more").click(function(){$(this).toggleClass("expanded");if($(this).hasClass("expanded")){$(".more-label-button").removeClass("sprite-plus-button").addClass("sprite-minus-button");$(".more-label-text").html("Less...");$(".more-details").show(500)}else{$(".more-label-button").removeClass("sprite-minus-button").addClass("sprite-plus-button");$(".more-label-text").html("More...");$(".more-details").hide(500)}});$("#ContactName").autocomplete({source:function(e,f){$.ajax({url:siteRoot+"Shared/AutoCompleteContactList",type:"POST",dataType:"json",data:{term:$("#ContactName").val()},success:function(g){f($.map(g,function(h){return{label:h.Label,dataName:h.Name,dataEmail:h.Email,dataPhone:h.Phone}}))}})},minLength:3,focus:function(e,f){$("#ContactName").val(f.item.dataName);return false},select:function(e,f){$("#ContactName").val(f.item.dataName);$("#ContactPhone").val(f.item.dataPhone);$("#ContactEmail").val(f.item.dataEmail);return false}});toggleLessonType();toggleCloseLessonType();$("input[name='IsLessonTypeValidSelected']").livequery(function(){$(this).change(function(){toggleLessonType()})});$("input[name='CloseIsLessonTypeValidSelected']").livequery(function(){$(this).change(function(){toggleCloseLessonType()})});$(".delete-comment").live("click",function(){var e=$(this);$('<div>Are you sure you wish to delete the "'+e.attr("data-commentType")+'" comment?</div>').dialog({modal:true,width:300,title:"Delete the Comment?",draggable:false,resizable:false,buttons:{Delete:function(){var f=$('<form action="'+e.attr("data-url")+'" method="post"></form>');$("body").append(f);f.submit()},Cancel:function(){$(this).dialog("close")}}}).dialog("open");return false});$(".Un-delete-comment").live("click",function(){var e=$('<form action="'+$(this).attr("data-url")+'" method="post"></form>');$("body").append(e);e.submit();return false})});function toggleLessonType(){if($("input[name='IsLessonTypeValidSelected']:checked").val()=="True"){$("#LessonTypeInvalidId-button").hide();$("#LessonTypeValidId-button").show()}else{$("#LessonTypeValidId-button").hide();$("#LessonTypeInvalidId-button").show()}}function toggleCloseLessonType(){if($("input[name='CloseIsLessonTypeValidSelected']:checked").val()=="True"){$("#CloseLessonTypeInvalidId-button").hide();$("#CloseLessonTypeValidId-button").show()}else{$("#CloseLessonTypeValidId-button").hide();$("#CloseLessonTypeInvalidId-button").show()}};