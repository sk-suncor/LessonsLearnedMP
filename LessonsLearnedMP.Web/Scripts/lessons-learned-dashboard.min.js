$(function(){$("#Year").selectmenu();UpdateOpenLessonsPlot();UpdateClosedLessonsPlot();$("#Year, #IsValidSelected").change(function(){UpdateClosedLessonsPlot()});$("#ClosedLessonsChart").bind("jqplotDataClick",function(b,d,c,a){SearchClosedLessons(series[d].lessonTypeId,c)});$("#OpenLessonsPie").bind("jqplotDataClick",function(b,d,c,a){SearchOpenLessons(a[2])});$(".open-lesson-legend").live("click",function(){SearchOpenLessons($(this).attr("data-statusId"));return false});$(".closed-lesson-legend").live("click",function(){SearchClosedLessons($(this).attr("data-lessonTypeId"));return false})});function SearchClosedLessons(j,k){var e=$('<input id="LessonTypeValidId" name="LessonTypeValidId" value="" type="hidden" />');var d=$('<input id="LessonTypeInvalidId" name="LessonTypeInvalidId" value="" type="hidden" />');var h=$("input:radio[name=IsValidSelected]");if(h.filter("[value=False]").attr("checked")){d.val(j)}else{e.val(j)}var m=$("#Year").val();var i=new Date(m,0,1);var l=new Date(parseInt(m)+1,0,0);if(typeof k!=="undefined"){i=new Date(m,k,1);l=new Date(m,k+1,0)}var a=$('<input id="ClosedDateBegin" name="ClosedDateBegin" value="" type="hidden" />');var b=$('<input id="ClosedDateEnd" name="ClosedDateEnd" value="" type="hidden" />');var f=$('<input id="ShowOnlyOwnedLessons" name="ShowOnlyOwnedLessons" value="False" type="hidden" />');var g=$('<input id="Status" name="Status" value="6" type="hidden" />');a.val(i.format("yyyy-MM-dd"));if(m==0){l=new Date(2009,12,0);a.val("")}b.val(l.format("yyyy-MM-dd"));f.val((admin?"False":"True"));var c=$('<form action="/Lesson/MyLessons" method="post"></form>');c.append(a);c.append(b);c.append(f);c.append(g);c.append(e);c.append(d);$("body").append(c);c.submit()}function SearchOpenLessons(c){var b=$('<input id="Status" name="Status" value="" type="hidden" />');b.val(c);var a=$('<form action="/Lesson/MyLessons" method="post"></form>');a.append(b);$("body").append(a);a.submit()}var openLessonsPlot;var closedLessonsPlot;function UpdateOpenLessonsPlot(){if(openLessonsPlot){openLessonsPlot.destroy()}$.ajax({url:siteRoot+"Dashboard/GetOpenLessonsChartData",type:"POST",data:{noCache:Date()},success:function(e){var a=[];var b=[];var f=[];var c=[];var d=[];var g=0;$(e).each(function(){var j=[this.Label,this.Percent,this.StatusId];a.push(j);g+=this.Count;var h=$('<div class="status-'+this.StatusId+'"></div>').hide().appendTo("body");var n="Black";var l=h.css("background-color");h.remove();var i=$('<div class="status-highlight-'+this.StatusId+'"></div>').hide().appendTo("body");var m=i.css("background-color");i.remove();var k='<div style="color:'+n+'; width:75px">'+this.Label+" "+this.Percent+"%</div>";b.push(k);f.push(l);c.push(m);d.push('<a href="#" data-statusId="'+this.StatusId+'" class="open-lesson-legend">'+this.Label+" ("+this.Count+")</a>")});openLessonsPlot=jQuery.jqplot("OpenLessonsPie",[a],{sortData:false,seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:true,dataLabels:b,sliceMargin:4,highlightColors:c},seriesColors:f},legend:{show:true,labels:d,location:"ne",placement:"outsideGrid"},noDataIndicator:{show:true,indicator:"There are no open lessons."}});$(".total-open-lessons").html(g)}})}var series=[];function UpdateClosedLessonsPlot(){if(closedLessonsPlot){closedLessonsPlot.destroy()}var a=$("input[name='IsValidSelected']:checked").val();if(!a){a="True"}var b=$("#Year").val();if(!b){b=currentYear}$.ajax({url:siteRoot+"Dashboard/GetClosedLessonsChartData",type:"POST",data:{year:b,isValidSelected:a,noCache:Date()},success:function(c){var h=0;series=[];var d=[];var f=0;$(c).each(function(){var l=0;var m=[];var j=this;var k=0;$(j.Detail).each(function(){var n=this;k+=n.Count;m.push(n.Count)});h+=k;var i='<a href="#" data-lessonTypeId="'+j.LessonTypeId+'" class="closed-lesson-legend">'+j.LessonTypeName+" ("+k+")</a>";series.push({label:i,lessonTypeId:j.LessonTypeId});d.push(m)});var g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(h==0){d=[]}var e="Valid";if(a=="False"){e="Invalid "}closedLessonsPlot=$.jqplot("ClosedLessonsChart",d,{stackSeries:true,sortData:false,seriesDefaults:{renderer:$.jqplot.BarRenderer,tickRenderer:$.jqplot.AxisTickRenderer,rendererOptions:{barMargin:30},},series:series,axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:g},yaxis:{padMin:0,tickInterval:Math.round(h/20)+1}},highlighter:{show:true,formatString:'<table class="jqplot-highlighter"><tr><td><div class="display-none">%s</div>%s</td></tr></table>',sizeAdjust:7.5},legend:{show:true,location:"ne",placement:"outsideGrid"},noDataIndicator:{show:true,indicator:"There are no closed lessons for the selected year."}});$(".lesson-type-label").html(e);$(".year-label").html($("#Year").selectmenu("text"));$(".total-closed-lessons").html(h)}})};